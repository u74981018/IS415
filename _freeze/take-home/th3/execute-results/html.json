{
  "hash": "73939710d41f501063b15892ab27cf64",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home 3\"\nauthor: \"Lucas Vial\"\ndate: \"Nov 2 2024\"\ndate-modified: \"Date\"\nexecute: \n  eval: false\n  echo: true\n  freeze: true\n  warning: false\n---\n\n\n### Task Goals\n\nImport R Packages\n\nPrepare and Test R code so output is correct\n\nDetermine and prepare parameters and outputs for shiny\n\nSelect appropriate shiny components\n\n## Import R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sfdep, tidyverse, sf, tmap, lubridate, spatstat, dplyr, ggplot2, viridis, magick, raster, sparr, rmapshaper)\n```\n:::\n\n\n### Import Data\n\nAspatial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nps <- readRDS(\"data/3data/aspatial/points_study.rds\")\n```\n:::\n\n\nGeospatial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadm1 <- readRDS(\"data/3data/geospatial/papua_adm1.rds\")\nadm2 <- readRDS(\"data/3data/geospatial/papua_adm2.rds\")\n```\n:::\n\n\nBoth of these datasets have been fully prepared for use by my group member Immanuel\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- st_join(adm2, ps, by = c(\"WADMPR\" = \"admin2\")) %>% \n  dplyr::select(1:5, 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_cleaned <- sf_polygon %>%\n  group_by(WADMKK) %>%\n  filter(area == max(area)) %>%\n  ungro\n```\n:::\n\n\n## Shiny Storyboard\n\nThis tab will allow the user to see a STKDE Animation with a Contour plot to help explain.\n\n![](images/clipboard-2754455457.png)\n\n### Calibration Parameters\n\n+----------------+------------------------+------------------------------------------------------------------------------------------------+\n| Parameter      | Type                   | Filter Options                                                                                 |\n+================+========================+================================================================================================+\n| Study Area     | Multi-Select, Dropdown | **`All`**, `Papua`, `Papua Barat`, `Papua Barat Daya`, (Including every other Region and City) |\n+----------------+------------------------+------------------------------------------------------------------------------------------------+\n| Show STKDE by  | Radio Buttons          | `Month`, **`Quarter`**                                                                         |\n+----------------+------------------------+------------------------------------------------------------------------------------------------+\n| Year           | Multi-Select,          | **`All`** , `2015`, `2016`, `2017`, etc                                                        |\n|                |                        |                                                                                                |\n|                | Dropdown               |                                                                                                |\n+----------------+------------------------+------------------------------------------------------------------------------------------------+\n\nI've added a Year Filter Option Here, this was not included in the original proposal but I'll include it here due to the animation taking a long time to generate with the entire dataset, I also wouldn't be suprised if eventually I end up implementing a date range similar to the other pages in the proposal.\n\n## STKDE Animation\n\nData Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert `event_date` to the dmy format using Lubridate\nmonthly_data <- ps %>%\n  mutate(event_date = dmy(event_date))\n\n# Determine the first and last event dates\nstart_date <- min(monthly_data$event_date, na.rm = TRUE)\nend_date <- max(monthly_data$event_date, na.rm = TRUE)\n\n# Calculate the number of months between the first and last dates\nnum_months <- interval(start_date, end_date) %/% months(1) + 1\n\n# Add a month number column to the data\nmonthly_data <- monthly_data %>%\n  mutate(month_no = interval(start_date, event_date) %/% months(1) + 1)\n```\n:::\n\n\nAs is, the admin borders are really large and have a significant impact on runtime, this code simplifies them and makes them usable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadm2_window <- as.owin(adm2)\nadm2_simplified <- ms_simplify(adm2, keep = 0.05)  # Adjust `keep` as needed\nadm2_window <- as.owin(adm2_simplified)\n```\n:::\n\n\nGo Through each month in the data and create a STKDE plot, label it appropriately and place it in the designated folder\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set the output directory for images\noutput_directory <- \"images/quarterly\"\n\n# Loop through each month to create Kernel Density Estimates (KDE)\nfor (month_index in 1:num_months) {\n  # Filter data for the current month\n  current_month_data <- monthly_data %>%\n    filter(month_no == month_index)\n\n  # Check if there are points to create KDE\n  if (nrow(current_month_data) > 0) {\n    # Convert the geometry to a ppp object\n   montly_ppp <- as.ppp(current_month_data)\n   monthly_owin <- montly_ppp[adm2_window]\n   kde <- density(monthly_owin)\n   kde_raster <- raster(kde)\n    \noutput_file <- file.path(output_directory, paste0(\"kde_month_\", month_index, \".png\"))\n\n# Open a PNG device to save the plot\npng(filename = output_file, width = 800, height = 600)  # Adjust dimensions as needed\n\n# Plot the raster and add any customizations\nplot(kde_raster, main = paste(\"Month:\", month_index))\ndev.off()\n  } else {\n    message(paste(\"No data available for month:\", month_index))\n  }\n}\n```\n:::\n\n\nFrom the previous folder, put all the plots into a GIF and save it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfolder_path <- \"images/quarterly\"\n\n# Get a list of all image files in the folder (e.g., PNG, JPG files)\nimage_files <- list.files(folder_path, pattern = \"\\\\.png$\", full.names = TRUE)\nimage_files <- image_files[order(as.numeric(str_extract(basename(image_files), \"\\\\d+\")))]\n\nimages <- image_read(image_files)\ngif <- image_animate(images, fps = 2)  \n\n# Save the GIF\nimage_write(gif, path = \"output.gif\")\n```\n:::\n\n\n![Gif Output](output.gif)\n\nI've not Implemented any of the Time or Space Filtering, but those will be simple to do. They will also pose different challenges when Implementing it in the shiny environment compared to a quarto doc.\n\n### Contour Plot \n\nThe team has (since the project proposal) decided not to implement a contour plot. it was cited that the professor said that they aren't that useful.\n",
    "supporting": [
      "th3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}