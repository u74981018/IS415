{
  "hash": "de1f2623a3712f80b5c03ea59b20cc3b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-class 9 - Week 10\"\nauthor: \"Lucas Vial\"\ndate: \"Oct 21 2024\"\ndate-modified: \"Date\"\nexecute: \n  eval: false\n  echo: true\n  freeze: true\n  warning: false\n---\n\n\nPackages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(spdep, sp, tmap, sf, ClustGeo, cluster, factoextra, NbClust, tidyverse, GGally)\n```\n:::\n\n\nData Import\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf <- read_rds(\"data/In-class_Ex09/data/rds/shan_sf.rds\")\n\nshan_ict <- read_rds(\"data/In-class_Ex09/data/rds/shan_ict.rds\")\n\nshan_sf_cluster <- read_rds(\"data/In-class_Ex09/data/rds/shan_sf_cluster.rds\")\n```\n:::\n\n\n## Standard Cluster Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproxmat <- dist(shan_ict, method = \"euclidean\") \nhclust_ward <- hclust(proxmat, method = \"ward.D\")\ngroups <- as.factor(cutree(hclust_ward, k = 6))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf_cluster <- cbind(shan_sf,\n                         as.matrix(groups)) %>%\n  rename(`CLUSTER`=`as.matrix.groups.`) %>%\n  select(-c(3:4, 7:9)) %>%\n  rename(TS = TS.x)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(hclust_ward, cex = 0.6)\nrect.hclust(hclust_ward, k=6, border = 2:5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(shan_sf_cluster, \"CLUSTER\")\n```\n:::\n\n\nSpatially constrained clustering\n\n-   based off variable factors and its location\n\nSKATER\n\n-   Spatial Cluster Analysis by Tree Edge Removal\n\n-   Graph Theory (Distance then Attribute)\n\nREDCAP\n\n-   Regionalization with dynamically constrained agglometriive\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndist <- st_distance(shan_sf, shan_sf)\ndistmat <- as.dist(dist)\n```\n:::\n\n\n## SKATER\n\nNearest Neighbours/Creating the graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.nb <- poly2nb(shan_sf) # differnt in hands on this better\nsummary(shan.nb)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(shan_sf),\n     border=grey(.5))\npts <- st_coordinates(st_centroid(shan_sf))\nplot(shan.nb,\n     pts,\n     col=\"blue\",\n     add=TRUE)\n```\n:::\n\n\nMinimum Spanning Tree\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlcosts <- nbcosts(shan.nb, shan_ict)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.w <- nb2listw(shan.nb,\n                   lcosts,\n                   style=\"B\")\nsummary(shan.w)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.mst <- mstree(shan.w)\n\nplot(st_geometry(shan_sf),\n     border=gray(.5))\nplot.mst(shan.mst,\n         pts,\n         col=\"blue\",\n         cex.lab=0.7,\ncex.circles=0.005,\nadd=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskater.clust6 <- skater(edges = shan.mst[,1:2],\n                        data = shan_ict,\n                        method = \"euclidean\",\n                        ncuts = 5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(shan_sf),\n     border=gray(.5)) \nplot(skater.clust6,\n     pts,\n     cex.lab=.7,\n     groups.colors=c(\"red\",\"blue\",\"green\",\"brown\",\"pink\"),\n     cex.circles=0.005,\n     add=TRUE)\n```\n:::\n\n\n## Clusters in Choropleth Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngroups_mat <- as.matrix(skater.clust6$groups)\nshan_sf_spatialcluster <- cbind(shan_sf_cluster, as.factor(groups_mat)) %>%\n    rename(`skater_CLUSTER`=`as.factor.groups_mat.`)\nqtm(shan_sf_spatialcluster, \"skater_CLUSTER\")\n```\n:::\n\n\n## ClustGeo Method\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr <- choicealpha(proxmat, distmat,\n                  range.alpha = seq(0,1,0.1),\n                  K=6, graph=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclustG <- hclustgeo(proxmat, distmat, alpha=0.2)\ngroups <- as.factor(cutree(clustG, k=6))\nshan_sf_clustGeo <- cbind(shan_sf,\n                          as.matrix(groups)) %>%\n  rename(`clustGeo`=`as.matrix.groups.`)\nqtm(shan_sf_clustGeo, \"clustGeo\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# gg array package\nggparcoord(data = shan_sf_clustGeo,\n           columns = c(17:21),\n           scale=\"globalminmax\",\n           alphaLines = 0.2,\n           boxplot = TRUE,\n           title = \"Multiple Parallel Coordinates Plots of ICT Variables by Cluster\") + facet_grid(~ clustGeo) +\n  theme(axis.text.x = element_text(angle = 30))\n```\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}